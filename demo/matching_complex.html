

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>A Matching Problem with Fairness Constraints &mdash; DuaLip  documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=b86133f3" />
      <link rel="stylesheet" type="text/css" href="../_static/css/theme.css?v=9edc463e" />
      <link rel="stylesheet" type="text/css" href="../_static/custom.css?v=66161cb2" />

  
      <script src="../_static/jquery.js?v=5d32c60e"></script>
      <script src="../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../_static/documentation_options.js?v=5929fcd5"></script>
      <script src="../_static/doctools.js?v=fd6eb6e6"></script>
      <script src="../_static/sphinx_highlight.js?v=6ffebe34"></script>
      <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@4/tex-mml-chtml.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Citing DuaLip" href="../citing/index.html" />
    <link rel="prev" title="A Matching Problem" href="matching.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html" class="icon icon-home">
            DuaLip
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">User Documentation</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../solver/index.html">The DuaLip Solver</a></li>
<li class="toctree-l1"><a class="reference internal" href="../interfaces/index.html">Solver Interface</a></li>
<li class="toctree-l1"><a class="reference internal" href="../get_started/index.html">Installation Guide</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Demo</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="matching.html">A Matching Problem</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">A Matching Problem with Fairness Constraints</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#fairness-across-user-types">Fairness across user types</a></li>
<li class="toctree-l3"><a class="reference internal" href="#augmenting-a-and-b">Augmenting A and b</a></li>
<li class="toctree-l3"><a class="reference internal" href="#extending-the-gradient-calculation">Extending the Gradient Calculation</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../citing/index.html">Citing DuaLip</a></li>
<li class="toctree-l1"><a class="reference internal" href="../contributing/index.html">Contributing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../acknowledgement/index.html">Acknowledgements</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">DuaLip</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="index.html">Demo</a></li>
      <li class="breadcrumb-item active">A Matching Problem with Fairness Constraints</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/demo/matching_complex.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="a-matching-problem-with-fairness-constraints">
<span id="matching-complex"></span><h1>A Matching Problem with Fairness Constraints<a class="headerlink" href="#a-matching-problem-with-fairness-constraints" title="Link to this heading"></a></h1>
<p>Buidling on the problem formulation descrived in <a class="reference internal" href="matching.html"><span class="doc">A Matching Problem</span></a>, we now wish to consider a matching probelem with fairness constraints. We assume the base matching formulation, data layout,
and solver workflow described in <a class="reference internal" href="matching.html"><span class="doc">A Matching Problem</span></a>, and focuses only on adding fairness constraints between two
user types and demonstrate how the objective function class can be easily extended to support more complex constraints.</p>
<section id="fairness-across-user-types">
<h2>Fairness across user types<a class="headerlink" href="#fairness-across-user-types" title="Link to this heading"></a></h2>
<p>Assume we have two user types: users with IDs <span class="math notranslate nohighlight">\(1,2\)</span> belong to type 1 and users with IDs
<span class="math notranslate nohighlight">\(3,4\)</span> belong to type 2. We wish to ensure type 1 and type 2 receive almost the same total
number of recommendations (in expectation). Let</p>
<div class="math notranslate nohighlight">
\[T_1 = \{1,2\}, \qquad T_2 = \{3,4\}.\]</div>
<p>Define a tolerance <span class="math notranslate nohighlight">\(\delta \ge 0\)</span> that bounds the allowed deviation between the total
recommendations to the two types. We impose the following linear fairness constraints:</p>
<div class="math notranslate nohighlight">
\[\begin{split}\begin{array}{ll}
  \frac{1}{|T_1|}\sum_{i \in T_1}\sum_k x_{ik} - \frac{1}{|T_2|}\sum_{i \in T_2}\sum_k x_{ik} \le \delta \\
 -\frac{1}{|T_1|}\sum_{i \in T_1}\sum_k x_{ik} + \frac{1}{|T_2|}\sum_{i \in T_2}\sum_k x_{ik} \le \delta
\end{array}\end{split}\]</div>
<p>Together these enforce <span class="math notranslate nohighlight">\(\big|\frac{1}{|T_1|}\sum_{i \in T_1,k} x_{ik} - \frac{1}{|T_2|}\sum_{i \in T_2,k} x_{ik}\big|
\le \delta\)</span>. Setting <span class="math notranslate nohighlight">\(\delta=0\)</span> enforces exact parity; a small <span class="math notranslate nohighlight">\(\delta&gt;0\)</span> allows a
bounded imbalance.</p>
</section>
<section id="augmenting-a-and-b">
<h2>Augmenting A and b<a class="headerlink" href="#augmenting-a-and-b" title="Link to this heading"></a></h2>
<p>Using the notation in <a class="reference internal" href="matching.html"><span class="doc">A Matching Problem</span></a>, the vector/matrix form of the optimization remains the same,
but the constraint matrix <span class="math notranslate nohighlight">\(A\)</span> and vector <span class="math notranslate nohighlight">\(b\)</span> are augmented as follows:</p>
<ol class="arabic simple">
<li><p>Keep the <span class="math notranslate nohighlight">\(K\)</span> rows for movie limits <span class="math notranslate nohighlight">\(\sum_i x_{ik} \le b_k\)</span>.</p></li>
<li><p>Add one row with coefficient <span class="math notranslate nohighlight">\(\frac{1}{|T_1|}\)</span> on variables <span class="math notranslate nohighlight">\(x_{ik}\)</span> for <span class="math notranslate nohighlight">\(i \in T_1\)</span>
and <span class="math notranslate nohighlight">\(-\frac{1}{|T_2|}\)</span> for <span class="math notranslate nohighlight">\(i \in T_2\)</span>, with RHS <span class="math notranslate nohighlight">\(\delta\)</span>.</p></li>
<li><p>Add one row with coefficient <span class="math notranslate nohighlight">\(-\frac{1}{|T_1|}\)</span> on variables <span class="math notranslate nohighlight">\(x_{ik}\)</span> for <span class="math notranslate nohighlight">\(i \in T_1\)</span>
and <span class="math notranslate nohighlight">\(\frac{1}{|T_2|}\)</span> for <span class="math notranslate nohighlight">\(i \in T_2\)</span>, with RHS <span class="math notranslate nohighlight">\(\delta\)</span>.</p></li>
</ol>
<p>For steps 2 and 3, we add the following function to the matching objective function class:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">_build_fairness_constraints</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">]:</span>
    <span class="n">num_cols</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">A</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">group_1_size</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">num_cols</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">group_ratio</span><span class="p">)</span>
    <span class="n">group_1_size</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">min</span><span class="p">(</span><span class="n">group_1_size</span><span class="p">,</span> <span class="n">num_cols</span><span class="p">))</span>
    <span class="n">group_2_size</span> <span class="o">=</span> <span class="n">num_cols</span> <span class="o">-</span> <span class="n">group_1_size</span>

    <span class="c1"># Split columns into first group and second group (remaining)</span>
    <span class="n">A_blocks</span> <span class="o">=</span> <span class="n">split_csc_by_cols</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">A</span><span class="p">,</span> <span class="p">[</span><span class="n">group_1_size</span><span class="p">,</span> <span class="n">group_2_size</span><span class="p">])</span> <span class="k">if</span> <span class="n">num_cols</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">A</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">A</span><span class="p">]</span>
    <span class="n">A_group_1</span><span class="p">,</span> <span class="n">A_group_2</span> <span class="o">=</span> <span class="n">A_blocks</span>

    <span class="c1"># Normalize the first group</span>
    <span class="n">A_group_1</span> <span class="o">=</span> <span class="mi">1</span><span class="o">/</span><span class="n">group_1_size</span> <span class="o">*</span> <span class="n">A_group_1</span>
    <span class="c1"># Negate and normalizethe second group&#39;s columns</span>
    <span class="n">A_group_2</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="o">/</span><span class="n">group_2_size</span> <span class="o">*</span> <span class="n">A_group_2</span>
    <span class="c1"># Concatenate back column-wise to match original shape/pattern</span>
    <span class="n">A_fairness</span> <span class="o">=</span> <span class="n">hstack_csc</span><span class="p">([</span><span class="n">A_group_1</span><span class="p">,</span> <span class="n">A_group_2</span><span class="p">])</span>

    <span class="k">return</span> <span class="n">A_fairness</span>
</pre></div>
</div>
<p>where A_fairness is passed to the objective function as an additional constraint matrix.</p>
<p>Equivalently, if <span class="math notranslate nohighlight">\(b=(b_1,\ldots,b_K)\)</span> in <a class="reference internal" href="matching.html"><span class="doc">A Matching Problem</span></a>, here we use
<span class="math notranslate nohighlight">\(b'=(b_1,\ldots,b_K,\delta,\delta)\)</span>.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>To include the fairness constraints described here, add the two fairness rows to <span class="math notranslate nohighlight">\(A\)</span>
and append <span class="math notranslate nohighlight">\((\delta, \delta)\)</span> to <span class="math notranslate nohighlight">\(b\)</span> before saving the tensors. Since fairness constraints introduce
constraint structure not handled by the default matching objective function, we need to extend the objective function to support fairness constraints.</p>
</div>
</section>
<section id="extending-the-gradient-calculation">
<h2>Extending the Gradient Calculation<a class="headerlink" href="#extending-the-gradient-calculation" title="Link to this heading"></a></h2>
<p>To extend the objective function to support fairness constraints, we use the <code class="xref py py-class docutils literal notranslate"><span class="pre">MatchingSolverDualObjectiveFunction</span></code> class and override the <code class="xref py py-meth docutils literal notranslate"><span class="pre">calculate()</span></code> method.
The new gradient calculation is given by:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span> <span class="k">def</span><span class="w"> </span><span class="nf">calculate</span><span class="p">(</span>
     <span class="bp">self</span><span class="p">,</span>
     <span class="n">dual_val</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span>
     <span class="n">gamma</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
     <span class="n">save_primal</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
 <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ObjectiveResult</span><span class="p">:</span>
<span class="w">     </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">     Compute dual gradient, objective, and reg penalty.</span>

<span class="sd">     Args:</span>
<span class="sd">         dual_val: current dual variables</span>
<span class="sd">         gamma: regularization parameter</span>
<span class="sd">         save_primal: if True, save the primal variable</span>

<span class="sd">     Returns:</span>
<span class="sd">         ObjectiveResult</span>
<span class="sd">     &quot;&quot;&quot;</span>
     <span class="n">grad</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">dual_val</span><span class="p">)</span>

     <span class="k">if</span> <span class="n">gamma</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
         <span class="bp">self</span><span class="o">.</span><span class="n">gamma</span> <span class="o">=</span> <span class="n">gamma</span>

     <span class="c1"># -dual_val/gamma</span>
     <span class="n">scaled</span> <span class="o">=</span> <span class="o">-</span><span class="mf">1.0</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">gamma</span> <span class="o">*</span> <span class="n">dual_val</span>

     <span class="c1"># intermediate = A * scaled</span>
     <span class="n">left_multiply_sparse</span><span class="p">(</span><span class="n">scaled</span><span class="p">[:</span><span class="o">-</span><span class="mi">2</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">A</span><span class="p">,</span> <span class="n">output_tensor</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">intermediate</span><span class="p">)</span>

<span class="hll">     <span class="c1"># intermediate += A_fairness * scaled</span>
</span><span class="hll">     <span class="n">elementwise_csc</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">intermediate</span><span class="p">,</span> <span class="n">scaled</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">A_fairness</span><span class="p">,</span> <span class="n">add</span><span class="p">,</span> <span class="n">output_tensor</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">intermediate</span><span class="p">)</span>
</span>
<span class="hll">     <span class="c1"># intermediate += -A_fairness * scaled</span>
</span><span class="hll">     <span class="n">elementwise_csc</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">intermediate</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span> <span class="o">*</span> <span class="n">scaled</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">A_fairness</span><span class="p">,</span> <span class="n">add</span><span class="p">,</span> <span class="n">output_tensor</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">intermediate</span><span class="p">)</span>
</span>
     <span class="c1"># intermediate += c_rescaled</span>
     <span class="n">elementwise_csc</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">intermediate</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">c_rescaled</span><span class="p">,</span> <span class="n">add</span><span class="p">,</span> <span class="n">output_tensor</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">intermediate</span><span class="p">)</span>

     <span class="c1"># apply each projection</span>
     <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">proj_item</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">buckets</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
         <span class="n">buckets</span> <span class="o">=</span> <span class="n">proj_item</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
         <span class="n">proj_type</span> <span class="o">=</span> <span class="n">proj_item</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
         <span class="n">proj_params</span> <span class="o">=</span> <span class="n">proj_item</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
         <span class="n">fn</span> <span class="o">=</span> <span class="n">project</span><span class="p">(</span><span class="n">proj_type</span><span class="p">,</span> <span class="o">**</span><span class="n">proj_params</span><span class="p">)</span>
         <span class="n">apply_F_to_columns</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">intermediate</span><span class="p">,</span> <span class="n">fn</span><span class="p">,</span> <span class="n">buckets</span><span class="p">,</span> <span class="n">output_tensor</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">intermediate</span><span class="p">)</span>

     <span class="c1"># dual gradient = row sums of A * intermediate</span>
<span class="hll">     <span class="n">grad</span><span class="p">[:</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">row_sums_csc</span><span class="p">(</span><span class="n">elementwise_csc</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">A</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">intermediate</span><span class="p">,</span> <span class="n">mul</span><span class="p">))</span>
</span><span class="hll">     <span class="n">grad</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">elementwise_csc</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">A_fairness</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">intermediate</span><span class="p">,</span> <span class="n">mul</span><span class="p">)</span><span class="o">.</span><span class="n">values</span><span class="p">()</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
</span><span class="hll">     <span class="n">grad</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">elementwise_csc</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">A_fairness</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">intermediate</span><span class="p">,</span> <span class="n">mul</span><span class="p">)</span><span class="o">.</span><span class="n">values</span><span class="p">()</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
</span><span class="hll">
</span>     <span class="c1"># reg penalty = (gamma/2) * ||intermediate.values||^2</span>
     <span class="n">vals</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">intermediate</span><span class="o">.</span><span class="n">values</span><span class="p">()</span>
     <span class="n">reg_penalty</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">gamma</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">torch</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">vals</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span>

     <span class="c1"># dual objective = c * intermediate.values</span>
     <span class="n">dual_obj</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">values</span><span class="p">(),</span> <span class="n">vals</span><span class="p">)</span>
     <span class="n">primal_obj</span> <span class="o">=</span> <span class="n">dual_obj</span><span class="o">.</span><span class="n">clone</span><span class="p">()</span>
     <span class="n">primal_var</span> <span class="o">=</span> <span class="n">vals</span>

     <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_distributed</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">b_vec</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
         <span class="n">grad</span><span class="p">,</span> <span class="n">dual_obj</span> <span class="o">=</span> <span class="n">calc_grad</span><span class="p">(</span><span class="n">grad</span><span class="p">,</span> <span class="n">dual_obj</span><span class="p">,</span> <span class="n">dual_val</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">b_vec</span><span class="p">,</span> <span class="n">reg_penalty</span><span class="p">)</span>

         <span class="n">dual_val_times_grad</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">dual_val</span><span class="p">,</span> <span class="n">grad</span><span class="p">)</span>
         <span class="n">max_pos_slack</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">grad</span><span class="p">),</span> <span class="mi">0</span><span class="p">)</span>
         <span class="n">sum_pos_slack</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">relu</span><span class="p">(</span><span class="n">grad</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>

         <span class="n">obj_result</span> <span class="o">=</span> <span class="n">ObjectiveResult</span><span class="p">(</span>
             <span class="n">dual_gradient</span><span class="o">=</span><span class="n">grad</span><span class="p">,</span>
             <span class="n">dual_objective</span><span class="o">=</span><span class="n">dual_obj</span><span class="p">,</span>
             <span class="n">reg_penalty</span><span class="o">=</span><span class="n">reg_penalty</span><span class="p">,</span>
             <span class="n">dual_val_times_grad</span><span class="o">=</span><span class="n">dual_val_times_grad</span><span class="p">,</span>
             <span class="n">max_pos_slack</span><span class="o">=</span><span class="n">max_pos_slack</span><span class="p">,</span>
             <span class="n">sum_pos_slack</span><span class="o">=</span><span class="n">sum_pos_slack</span><span class="p">,</span>
         <span class="p">)</span>
     <span class="k">else</span><span class="p">:</span>
         <span class="n">obj_result</span> <span class="o">=</span> <span class="n">ObjectiveResult</span><span class="p">(</span>
             <span class="n">dual_gradient</span><span class="o">=</span><span class="n">grad</span><span class="p">,</span>
             <span class="n">dual_objective</span><span class="o">=</span><span class="n">dual_obj</span><span class="p">,</span>
             <span class="n">reg_penalty</span><span class="o">=</span><span class="n">reg_penalty</span><span class="p">,</span>
         <span class="p">)</span>
     <span class="k">if</span> <span class="n">save_primal</span><span class="p">:</span>
         <span class="n">obj_result</span><span class="o">.</span><span class="n">primal_var</span> <span class="o">=</span> <span class="n">primal_var</span>
         <span class="n">obj_result</span><span class="o">.</span><span class="n">primal_objective</span> <span class="o">=</span> <span class="n">primal_obj</span>
     <span class="k">return</span> <span class="n">obj_result</span>
</pre></div>
</div>
<p>The above changes should be the main changes to the objective function to support fairness constraints.
Additional changes may be needed to the input arguments, and data preparation to support fairness constraints e.g., additional parameters such as group ration or tolerance.</p>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="matching.html" class="btn btn-neutral float-left" title="A Matching Problem" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="../citing/index.html" class="btn btn-neutral float-right" title="Citing DuaLip" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2026, LinkedIn.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>